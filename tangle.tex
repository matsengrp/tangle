\documentclass{amsart}

\usepackage{amsmath}
% \usepackage[german]{todonotes}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{example}[theorem]{Example}
\newtheorem{definition}[theorem]{Definition}

\newcommand{\RR}{\mathbb R}
\newcommand{\fS}{\mathfrak S}
\newcommand{\fA}{\mathfrak A}

\newcommand{\pairing}{\mu}
\newcommand{\tangle}{\mathsf{G}}
\newcommand{\ptree}{\mathsf{P}}
\newcommand{\ptpair}{\ptree^2}
\newcommand{\ptequiv}{\bar{\ptree}}  % Phylogenetic tree equivalence classes under the symmetric group.
\newcommand{\stpair}{\mathsf{Q}}  % Shape-tree pair.
\newcommand{\bigproj}{\tilde \pi}
\newcommand{\proj}{\pi}
\newcommand{\ident}{i}


\begin{document}
\title{Symmetries of tanglegrams}
\author[Matsen]{Frederick Matsen}
\address{}
\thanks{}

\date{\today}

\begin{abstract}
Many interesting problems in the discrete mathematics of phylogenetic trees are defined by the relative labeling of pairs of leaf-labeled trees.
These relative labelings are naturally formalized as tanglegrams.
Although there has been considerable work on planar embeddings of tanglegrams, there has been no work on their symmetries.
Such work would clarify how many such problems on relatively labeled pairs of trees there are, open up the possibility for amortized algorithms, and reveal natural symmetries of spaces associated with such problems.
In this paper we develop methods to enumerate tanglegrams up to isomorphism, and we investigate the representation of the symmetric group induced by its action on tanglegrams.
\end{abstract}

\maketitle

% % Make a todo table of contents.
% \makeatletter
% \providecommand\@dotsep{5}
% \makeatother
% \listoftodos\relax


\section{Introduction (quite rough!)}
Pairs of trees on the same leaf set come up everywhere in phylogenetics.
Many people work on problems concerning pairs of trees.
For example SPR.
Pairs of trees on the same taxa are endowed with a natural symmetry, which can be formalized as an action of the symmetric group.

Moreover, all of these problems do not concern the actual leaf labels as such, but rather use the leaf labels as markers that can be used to map leaves of one phylogenetic tree on to another.
Due to the natural symmetries that exist in all phylogenetic trees, any given problem has an alternative phrasing with leaf labels moved in one or both of the trees.
Thus all such problems that are defined as such are actually defined in terms of this \emph{relative} leaf labeling.

This concept of a relative leaf labeling has been formalized as a \emph{tanglegram}.
There has been extensive work concerning tanglegrams, focusing on the problem of drawing them in a way that has minimum crossings \cite{Buchin2008-lc,Lozano2008-tp,Bansal2009-ni,Bocker2009-xl,Fernau2010-an,Venkatachalam2010-zh}.

In this paper we explore the mapping of pairs of leaf-labeled trees into the set of tanglegrams and explore the action of the symmetric group on tanglegrams.


\section{Formalism}
All of our trees will be bifurcating (i.e.\ internal nodes have degree three), and without leaf labels if not otherwise specified.

start with labeled definition?
Labeled trees and elements of $\fS_n$
Although these labels don't have any real significance, they are convenient to use when referring to leaves.

\begin{definition}
\label{def:tanglegram}
An $n$-\emph{tanglegram} is an ordered triple $(t_1, t_2, \pairing)$ where $t_1$ and $t_2$ are trees with $n$ leaves, and $\pairing$ is a bijection from the leaves of $t_1$ to those of $t_2$ which we will call the ``pairing.''
Let $\tangle_n$ denote the set of $n$-tanglegrams.
\end{definition}
Note that we have not specified whether the trees in the definition are rooted or not.
There is no essential difference between these two cases because if present, as the root of $t_1$ is naturally paired with the root of $t_2$.
Thus we will assume that the trees are rooted.
Note that our definition considers $(t_1, t_2, \pairing)$ and $(t_2, t_1, \pairing^{-1})$ as different maps.
We can also consider an unordered tanglegram, or \emph{utanglegram}, by identifying them.

A common way of specifying a tanglegram is by specifying two trees with the same leaf labels, with the idea that pairs of leaves that share a label are paired in the tanglegram.
These labels do not themselves carry information for the tanglegram but just to make these connections, motivating the definition above in terms of a bijection.
However, for our purposes it will be useful to sometimes refer to a tanglegram as if it consists of a pair of trees on the same leaf labels such that pairs of leaves that share a label are paired in the tanglegram.


\section{Symmetric group action and tanglegram symmetries}
Let $\fS_n$ denote the symmetric group on $n$ items.
We define the action of $\fS_n$ on $n$-tanglegrams to be such that an element of the symmetric group reorders the image of the leaf-to-leaf mapping.
That is, for $\sigma_n \in \fS_n$ and $(t_1, t_2, \pairing) \in \tangle_n$,
\[
\sigma \cdot (t_1, t_2, \pairing) := (t_1, t_2, \sigma \cdot \pairing),
\]
where $\sigma \cdot \pairing$ is the leaf-to-leaf mapping obtained by rearranging the image of $\pairing$ according to $\sigma$, i.e.\ $(\sigma \cdot \pairing)(x) = \sigma(\pairing(x))$.

Thus far we have groups acting on the left, such that $(\sigma \tau) \cdot x = \sigma \cdot (\tau \cdot x)$.
When applied to a pairing $\mu$ this means that the group action happens on the image of $\mu$, i.e.\ the leaves of $t_2$.
However, we can effectively act on the leaves of $t_1$ by conjugating with $\pairing$:
\begin{equation}
\label{eq:rightAction}
(\pairing \alpha_1 \pairing^{-1}) \cdot g
= (t_1, t_2, \pairing \alpha_1 \pairing^{-1} \pairing)
= (t_1, t_2, \pairing \alpha_1)
\end{equation}

Given a (rooted) phylogenetic tree $t$ let $\fA(t)$ be its leaf automorphism group.
That is, if $t$ has $n$ leaves (excluding the root if it exists) these are the elements $\alpha$ of $\fS_n$ that do not change $t$ when applied permute its leaves.
Every tree has at least one cherry (a subtree of size 2) and thus the automorphism group of every tree has at least the symmetry of exchanging the two leaves of that cherry.

These symmetries determine the symmetries of the tanglegram.
It is clear that for $\alpha_2 \in \fA(t_2)$, and $g = (t_1, t_2, \pairing)$,
\[
\alpha_2 \cdot g = (t_1, t_2, \alpha_2 \pairing) = g.
\]
Furthermore, as with \eqref{eq:rightAction}, given $\alpha_1 \in \fA(t_1)$,
\[
(\pairing \alpha_1 \pairing^{-1}) \cdot g = (t_1, t_2, \pairing \alpha_1) = g.
\]
Define the automorphism group $\fA(g)$ of an $n$-tangle $g = (t_1, t_2, \pairing)$ to be the subgroup of $\fS_n$ generated by $\fA(t_1)$ and $\fA(t_2)$ in this way:
\[
\fA(g) = \langle \pairing \alpha_1 \pairing^{-1}, \alpha_2 \mid \alpha_1 \in \fA(t_1), \alpha_2 \in \fA(t_2) \rangle.
\]
\begin{proposition}
This is the same as graph automorphism.
\end{proposition}


\section{Computation}
How to describe the ensemble of tanglegrams.
For the purposes of classification it is more straightforward to specify tanglegrams in terms of standardized trees and a permutation rather than in terms of the bijection in Definition~\ref{def:tanglegram}.
Assume we are working with $n$ taxa.
Let $\ptree$ be the set of \emph{phylogenetic} trees on $n$ leaves.
Let $\ptequiv$ be the equivalence classes of $n$ taxon phylogenetic trees under the action of the symmetric group $\fS_n$ on the leaf labels, and let $k$ be the number of such equivalence classes.
These are in one-to-one correspondence with the (graph-isomorphically-) distinct unlabeled bifurcating trees.

Let us fix representatives $\{s_i\}_{i=1,\ldots,k}$ of the equivalence classes $\ptequiv$.
Any tree $t$ has a representative $s_i$ of its equivalence class in $\ptequiv$, and there is a corresponding $\sigma \in \fS_n$ that maps the leaf labels of $s_i$ to those of $t$.
We will call this $\sigma$ the \emph{standard permutation} of $t$.

Consider two phylogenetic trees $t_1, t_2$ with representatives $s_{(1)}$ and $s_{(2)}$ and standard permutations $\sigma_1$ and $\sigma_2$.
The group element $\sigma_2^{-1} \, \sigma_1$ maps the leaves of $s_{(1)}$ to the leaves of $s_{(2)}$ that they correspond to in the $(t_1, t_2)$ tanglegram.
Indeed, $\sigma_1$ maps the leaves of $s_{(1)}$ to the corresponding leaves of $t_1$, $t_1$ and $t_2$ have identical leaf labels for leaves connected in the tanglegram, and $\sigma_2^{-1}$ maps the leaves of $t_2$ to the corresponding leaves of $s_{(2)}$.
Thus the triple $(s_{(1)}, s_{(2)}, \sigma_2^{-1} \, \sigma_1)$ defines the tanglegram formed by the two phylogenetic trees $t_1$ and $t_2$.
In terms of the standardization this is
\[
\sigma \cdot (s_{(1)}, s_{(2)}, \sigma_2^{-1} \, \sigma_1) \mapsto (s_{(1)}, s_{(2)}, \sigma_2^{-1} \, \sigma \sigma_1).
\]



However, there are additional symmetries defined by automorphisms of the two trees: any pair of automorphisms $\alpha_1 \in \fA_1, \alpha_2 \in \fA_2$ induce an isomorphic tanglegram $(s_{(1)}, s_{(2)}, \left(\sigma_2 \alpha_2 \right)^{-1} \, \sigma_1 \alpha_1)$.
Define the \emph{standardization} of a (labeled) tanglegram to be the triple
\begin{equation}
\label{eq:orbit}
\left(s_{(1)}, s_{(2)}, \left\{(\sigma_2 \alpha_2)^{-1} \, \sigma_1 \alpha_1 : \alpha_1 \in \fA_1, \alpha_2 \in \fA_2  \right\}\right)
\end{equation}
or more simply $(s_{(1)}, s_{(2)}, [\sigma_2^{-1} \, \sigma_1])$ where the brackets imply equivalence class under the automorphisms.
The third element in this triple will be called the \emph{orbit} of the tanglegram.

There is a one-to-one correspondence between tanglegrams and standardizations.
.
Indeed, assume that we have two isomorphic tanglegrams, which we consider as a pair of labeled tanglegrams with an arbitrary label set.
The isomorphism between the two labeled tanglegrams can be expressed as a permutation $\tau$ of the leaf labels.
Each of the first trees must have the same standardization, and also the same orbit because $[\left(\tau \sigma_2\right)^{-1} \, \tau \sigma_1] = [\sigma_2^{-1} \, \sigma_1]$.
Now if we are given a standardization, we can pick a representative from the orbit and assemble the corresponding tanglegram, which is well defined because tree automorphisms do not change the underlying tanglegram.

Now given a list of trees $t_1, \ldots, t_\ell$ one can enumerate all tanglegrams formed by pairs of $t_i$ with two straightforward steps.
First, for each tree $t_i$ find a representative $s_{(i)}$ and standard permutation $\sigma_i$.
Second, create every triple $(s_{(i)}, s_{(j)}, \sigma_j^{-1} \sigma_i)$.
Third, compute the orbit \eqref{eq:orbit}.

Q: can we say anything about the number of tanglegrams?


Q: What representation is this?


\bibliographystyle{unsrt}
\bibliography{tangle}
\end{document}

