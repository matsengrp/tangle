% for sharelatex https://www.sharelatex.com/github/
% !TEX program = pdflatex

\documentclass{amsart}

\usepackage{amsmath}
\usepackage{cite}
\usepackage{graphicx}
\usepackage{url}
\usepackage{color}
\usepackage[notref,notcite]{showkeys}

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{corollary}{Corollary}
\newtheorem{proposition}{Proposition}
\newtheorem{example}{Example}
\newtheorem{definition}{Definition}
\newtheorem{observation}{Observation}

\newcommand{\RR}{\mathbb R}
\newcommand{\ZZ}{\mathbb Z}
\newcommand{\fS}{\mathfrak S}

\newcommand{\aut}{\mathcal A}
\newcommand{\pairing}{\mu}
\newcommand{\tree}{\mathsf{T}}
\newcommand{\shape}{\mathsf{S}}
\newcommand{\ptangle}{\mathsf{X}}
\newcommand{\tangle}{\mathsf{Y}}
\newcommand{\ltangle}{\mathsf{L}}
\newcommand{\id}{\iota}
\newcommand{\wrtwo}{\wr \ZZ_2}

% arxivness
\newcommand{\arxiv}[1]{#1}
\newcommand{\notarxiv}[1]{}

% notes
\definecolor{violet}{rgb}{0.730,0.555,0.769}
\definecolor{purple}{rgb}{0.459,0.109,0.538}
\definecolor{grey}{rgb}{0.4,0.4,0.4}
\newcommand{\EM}[1]{\colorbox{violet}{\textcolor{white}{Erick: #1}}}

\newcommand{\FIGspr}{\
\label{FIGspr}
\begin{figure}
  \arxiv{\includegraphics[width=4in]{figures/spr-definition}}
\caption{\
  A subtree-prune-regraft move.
}
\end{figure}
}

\newcommand{\FIGtanglegram}{\
\label{FIGtanglegram}
\begin{figure}
  \arxiv{\includegraphics[width=5in]{figures/relabeling-example}}
\caption{\
  Two equivalent planar embeddings of the same tanglegram.
  Alternatively, they can be thought of as two permutations that are equivalent after taking symmetries of $\ell_2$ into account, or more formally two elements of the symmetric group which are equivalent under the action of the leaf automorphism group of $\ell_2$.
}
\end{figure}
}

\newcommand{\FIGcount}{\
\label{FIGcount}
\begin{figure}
  \arxiv{\includegraphics[width=5in]{figures/count}}
\caption{\
  The number of tanglegrams and the number of phylogenetic trees.
  We note that the number of distinct tanglegrams is much smaller than the number of distinct pairs of phylogenetic trees.
}
\end{figure}
}



\begin{document}
\title{Symmetries of rooted tanglegrams}
\author[Matsen]{Frederick A. Matsen IV}
\address{Fred Hutchinson Cancer Research Center \\ Seattle, WA}
\thanks{Research supported in part by National Science Foundation award 1223057 and National Institutes of Health grant R01 GM113246-01}


\date{\today}

\begin{abstract}
Many interesting problems in the discrete mathematics of phylogenetic trees are defined in terms of the relative labeling of pairs of rooted leaf-labeled trees.
These relative labelings are naturally formalized as so-called ``tanglegrams.''
Although there has been considerable work on planar embeddings of tanglegrams, their symmetries have not yet been explored.
Understanding symmetries of tanglegrams would help enumerate the distinct problems on relatively labeled pairs of trees, enable amortized algorithms, and reveal natural symmetries of spaces associated with such problems.
In this paper we develop methods to enumerate tanglegrams up to isomorphism, and we investigate the representation of the symmetric group induced by its action on tanglegrams.
\end{abstract}

\maketitle


\section{Introduction}
As a motivating example, we consider the problem of computing the \emph{subtree-prune-regraft} (SPR) distance between two leaf-labeled phylogenetic trees.
An SPR move cuts one edge of the tree and then reattaches the resulting rooted subtree at another edge (Figure~\ref{FIGspr}).
The SPR distance between two (phylogenetic, meaning leaf-labeled) trees $\ell_1$ and $\ell_2$ is the minimum number of SPR moves required to transform $\ell_1$ into $\ell_2$.
[We will use different letters to distinguish between the various tree concepts: $t$ for a graph-theoretic tree, $p$ for a tree embedded in the plane, and $\ell$ for a phylogenetic (i.e.\ leaf-labeled) tree.]
\FIGspr

Let's say that we wanted to calculate the SPR distance between every pair of trees.
Na\"ively this would require the binomial coefficient given by the number of phylogenetic trees choose two.
However, the distance between two such trees does not depend on the actual labels of $\ell_1$ and $\ell_2$, so one can permute the numerical labels of the leaf nodes, which would result in the same distance if the permutation was applied identically on both the starting and ending trees (and trees on the shortest SPR path between the two).
Furthermore, a path made by SPR moves made by intermediate trees between the two trees could also have its labels permuted in order to give a path between the trees with permuted leaf labels.
Thus, problems like SPR distance do not concern the actual leaf labels as such, but rather use the leaf labels as markers that can be used to map leaves of one phylogenetic tree on to another.
The problem and its solutions are actually defined in terms of a \emph{relative} leaf labeling.

Such discrete mathematics problems and objects defined in terms of pairs of labeled combinatorial objects are ubiquitous in computational biology.
In addition to SPR distances and their cousin distances formed by \emph{nearest-neighbor-interchange} and \emph{tree bisection and reattachment} \cite{wiki:treeRearrangement}, we have their corresponding biological questions concerning ``supertree'' reconstruction \cite{Whidden2014-ku} and reconciliation of gene transfer networks \cite{Boon2013-mc}.
Because such moves are used in both maximum-likelihood heuristic search and Bayesian Markov chain Monte Carlo (MCMC) tree reconstruction, the geometry of phylogenetic trees under such moves has substantial consequences in terms of phylogenetic tree reconstruction \cite{Whidden2014-yt}.

Another line of inquiry in computational biology concerns species delimitation, which can naturally be phrased in terms of inference of a partition of labeled objects.
In an analogous way, scientists use MCMC to explore the posterior on such partitions \cite{Yang2010-kc}, and comparison of the results can be performed using distances between the partitions via distances such as \cite{Gusfield2002-il}.
These partitions can also be thought of as a certain type of leaf-labeled tree of height two (see description below), and thus they also form a problem concerning relative leaf labeling of phylogenetic trees.

The concept of a pair of phylogenetic trees with a relative leaf labeling can be formalized as the graph-theoretic notion of a \emph{tanglegram} (Figure~\ref{FIGtanglegram}).
A tanglegram is a pair of trees on the same set of leaves with matching leaves in the two trees joined by an edge. \cite{Venkatachalam2010-zh}.
There has been extensive work on the problem of drawing tanglegrams minimizing crossings \cite{Buchin2008-lc,Lozano2008-tp,Bansal2009-ni,Bocker2009-xl,Fernau2010-an,Venkatachalam2010-zh}.
\FIGtanglegram

However, there has been almost no work enumerating or finding other properties of this fundamental object which formalizes the notion of a relative leaf labeling of a pair of phylogenetic trees.
Described slightly more formally, one can consider the projections starting with ordered pairs of phylogenetic trees
\begin{equation}
\label{eq:projChain}
\tree_n \times \tree_n \xrightarrow{\pi_\tangle} \tangle_n \xrightarrow{\pi_\shape} \shape_n \times \shape_n
\end{equation}
where $\tree_n$ is the set of $n$-taxon phylogenetic trees, $\tangle_n$ is the set of tangles, and $\shape_n$ is the set of phylogenetic tree shapes (i.e.\ trees without leaf labels).
Rephrasing the above, many problems (such as SPR calculation) which are commonly phrased in terms of $\tree_n \times \tree_n$ are actually constant on pre-images of elements of $\tangle_n$ and thus factor to a problem on $\tangle_n$.

In this paper we develop a mathematical formalism and show that the question of enumerating tanglegrams is equivalent to enumerating certain single and double cosets in the symmetric group, both for labeled and non-labeled tangles.
There are efficient algorithms coded in GAP \cite{GAP4} for such enumeration, which we use and extend via the SAGE \cite{SteinJoyner2005} interface to GAP.
These algorithms are quite fast compared to simpler approaches such as checking graph isomorphism.
We explore the mapping of pairs of plane-embedded trees into the set of tanglegrams and explore the action of the symmetric group on tanglegrams by considering pre-images $\pi_\shape^{-1}(s_1, s_2)$ of each element of $(s_1, s_2) \in \shape_n \times \shape_n$ under $\pi_\shape$.
We can characterize the isomorphism classes in terms of the symmetries of the two phylogenetic trees they contain.
Furthermore, tanglegrams are equipped with a natural action of subgroups of the symmetric group on the leaf set, which we describe.
We will also be interested in symmetric tanglegrams, or \emph{stanglegrams}, in which the order of the two trees (or tree shapes) is forgotten.
This is formalized by replacing the Cartesian products in \eqref{eq:projChain} with symmetric products, and can be analyzed using extensions to the non-symmetric case.


\section{Tanglegrams}
\begin{definition}
\label{def:tanglegram}
A rooted (resp. unrooted) $n$-\emph{tanglegram} is an ordered triple $(t_1, t_2, \phi)$ consisting of two non-leaf-labeled rooted (resp.\ unrooted) trees $t_1$ and $t_2$ and a bijection $\phi$ from the leaves of $t_1$ to the leaves of $t_2$.
Let $\tangle_n$ denote the set of $n$-tanglegrams.
\end{definition}

It is easier to describe mappings between trees embedded in the plane than trees in the abstract, and thus we introduce the notion of a \emph{planar} tanglegram.
This notion is a slight simplification of the notion of a \emph{drawing} used by previous authors \cite{Venkatachalam2010-zh} which will be convenient for our purposes.
We use the term \emph{planar embedding} as it is used in graph theory.
If not otherwise specified, ``isomorphic'' applied to trees refers to usual graph isomorphism rather than an isomorphism of embedded trees.

Let $\fS_n$ denote the symmetric group on $n$ items.
\begin{definition}
\label{def:ptanglegram}
A rooted (resp.\ unrooted) \emph{planar $n$-tanglegram} is an ordered triple $(p_1, p_2, \pairing)$ where $p_1$ and $p_2$ are rooted (resp.\ unrooted) trees with $n$ leaves embedded in the plane, and $\pairing \in \fS_n$ giving the bijection between the leaves.
Let $\ptangle_n$ denote the set of planar $n$-tanglegrams.
\end{definition}

There is a graph realization of a tanglegram where every leaf of $t_1$ is connected via an edge to the corresponding leaf of $t_2$.
There is a clear 1-to-1 correspondence between tanglegrams under relabeling and their graph realization (assuming they are considered up to graph isomorphism) by joining leaves of $t_1$ with their corresponding leaves in $t_2$ under $\pairing$.
If the two trees are rooted, we assume that something is done to distinguish the root nodes from other nodes of the tree.
As described in the section on future work, the case of unrooted tanglegrams does not follow directly from an understanding of rooted tanglegrams, and we will limit ourselves to rooted tanglegrams for the purposes of this paper.
This notion of tanglegram corresponds to that found previously in the literature.

[Clarify what graph isomorphism means in this context.]

Note that our definition respects the order of $t_1$ and $t_2$ by considering $(t_1, t_2, \pairing)$ to be different than the tanglegram $(t_2, t_1, \pairing^{-1})$ when $t_1$ and $t_2$ are different graph theoretically.
We can also consider an symmetric tanglegram, or \emph{stanglegram}, by identifying them.


\subsection{Symmetries}
We will describe the symmetries of tanglegrams in terms of symmetries of the trees from which they are built.
We will use cycle notation for elements of the symmetric group, such as $(1\ 2) (3\ 4)$, which can be distinguished from phylogenetic trees in Newick format \cite{wiki:newick} such as $((1,2),(3,4));$, because symmetric group elements do not have commas or a trailing semicolon.
In order to conform to the convention used in GAP \cite{GAP4} and hence by SAGE \cite{SteinJoyner2005}, \emph{we will use the leftmost first convention of writing products in the symmetric group.}
Thus, in cycle notation, $(1\ 2) (1\ 3) = (1\ 2\ 3)$.
We will correspondingly consider groups as acting on the right, such that the action of $x.(\sigma \tau)$ is $(x.\sigma) . \tau)$.

\begin{definition}
Given a (rooted) phylogenetic tree $p$ on $n$ leaves embedded in the plane, let $\aut(p) \subset \fS_n$ be its leaf automorphism group: given a leaf labeling of $p$, $\aut(p)$ are the elements $\alpha$ of $\fS_n$ such that relabeling $p$ according to $\alpha$ results in an isomorphic leaf labeled tree.
\end{definition}
Because every tree has at least one subtree of size two, the automorphism group of every tree has at least the symmetry of exchanging the two leaves of that subtree.
These elements of $\fS_n$ can be thought of as providing relabelings for the leaves of a standard leaf labeling, as the group multiplication of two elements of $\fS_n$ is equivalent to the composition of the two relabelings.
Given two subgroups $J$ and $K$ of a group $G$, a \emph{double coset} $JgK$ for some $g \in G$ is the set of elements $\{jgk \mid j \in J, k \in K\}$.
Tree symmetries induce symmetries of planar tanglegrams via double cosets:
\begin{observation}
\label{obs:cosetMap}
There is a well-defined injective map from the set of distinct $n$-tanglegrams $(t_1, t_2, \pairing)$ to ordered triples $(t_1, t_2, C)$, where $C$ is a double coset of $\fS_n$ defined by taking an arbitrary planar embedding $(\tilde t_1, \tilde t_2, \pairing_\phi)$ of the tanglegram and mapping
\begin{equation}
\label{eq:cosetMap}
(t_1, t_2, \phi) \mapsto (t_1, t_2, \aut(t_1) \pairing_\phi \aut(t_2)).
\end{equation}
\end{observation}
This map is well defined because any $\pairing$ defined by an alternate planar embedding of the tanglegram only differs from the arbitrary embedding by elements of $\aut(t_1)$ and $\aut(t_2)$.
It is injective because any if any pair of planar tanglegrams $(\tilde t_1, \tilde t_2, \tilde \pairing)$ and $(\hat t_1, \hat t_2, \hat \pairing)$ map to the same element, it means that the trees are isomorphic in shape, defining $\alpha_i \in \fS_n$ mapping the leaves of $\tilde t_i$ to those of $\hat t_i$; then $\tilde \pairing = \alpha_1 \hat \pairing \alpha_2^{-1}$ and so they have the same double coset image under the mapping \eqref{eq:cosetMap}.

This map is thus a bijection onto its image, and so we will use the two representations interchangeably.
For example, we will refer often to the coset of a tanglegram.
We note that the various planar embeddings of the tanglegram graph are equivalent to choices of representatives $\pairing'$ of the coset tanglegram (i.e.\ $\pairing'$ such that $\aut(t_1) \pairing' \aut(t_2) = C$) given a choice of numbering for $t_1$.

For stanglegrams, there is an additional symmetry coming from inverting $\pairing$ when the two trees in the tanglegram have the same shape.


\subsection{Tanglegram enumeration}
The implementation of the enumeration of tanglegrams is in terms of \emph{standardized} phylogenetic trees.
These standardized phylogenetic trees are simply a choice of representative from the set of pre-images $\pi_\shape(s)$: one (leaf-labeled) phylogenetic tree $\{s_i\}_{i=1,\ldots,k}$ for each isomorphism class of phylogenetic trees on $n$ leaves under graph-theoretic isomorphism (as unlabeled tree topologies).
Any tree $\ell$ has a representative $s_i$ of its equivalence class, and there is a corresponding $\sigma \in \fS_n$ that maps the leaf labels of $s_i$ to those of $\ell$.
We will call this $\sigma$ the \emph{standard permutation} of $\ell$.
Note that all standard permutations are fixed for all trees on $n$ taxa once we choose a set of standardizations.

By simply standardizing the first tree of the $n$-tanglegrams, we note:
\begin{observation}
\label{obs:count}
The number of binary rooted $n$-tanglegrams is bounded above by the number of phylogenetic tree shapes on $n$ leaves times the number of phylogenetic trees on $n$ leaves, and thus is asymptotically smaller than the number of pairs of phylogenetic trees when the class of trees contains more than just the ``star tree'' with a single internal node.
\end{observation}

It is now straightforward to enumerate tanglegrams on $n$ leaves.
To start, one might to obtain all of the possible $n$-tanglegrams as the set of all triples $(t_1, t_2, C)$ as per Observation~\ref{obs:cosetMap}.
Consider two phylogenetic trees $\ell_1, \ell_2$ with representatives $s_{(1)}, s_{(2)}$ and standard permutations $\sigma_{(1)}$ and $\sigma_{(2)}$.
The group element $\sigma_{(1)}^{-1} \, \sigma_{(2)}$ maps the leaves of $s_{(1)}$ to the leaves of $s_{(2)}$ that they correspond as in the $[\ell_1, \ell_2, \id]$ tanglegram, where $\id$ is the identity element of the symmetric group.
Indeed, $\sigma_{(1)}^{-1}$ maps the leaves of $\ell_1$ to the corresponding leaves of $s_{(1)}$ and $\sigma_{(2)}$ maps the leaves of $\ell_2$ to the corresponding leaves of $s_{(2)}$.
Thus the triple $(s_{(1)}, s_{(2)}, \aut(s_{(1)}) \sigma_{(1)}^{-1} \, \sigma_{(2)} \aut(s_{(1)}))$ is an alternate way of writing the tanglegram $[\ell_1, \ell_2, \id]$.
Furthermore, one can take $\ell_1$ to be each of the standardized trees, so that $\sigma_1 = \id$, and $\ell_2$ to be all of the labeled trees such that $\sigma_2$ ranges over all of $\fS_n$.
Furthermore, by moving relabeling into the element of the symmetric group, we can just limit ourselves to $[\ell_1, \ell_2, \pairing]$ where $\ell_2$ is also a standardized tree.

Thus in order to obtain a complete enumeration of tanglegrams, one can enumerate double cosets of the form $\aut(t_1) \pairing \aut(t_2)$ for a given $t_1$ and $t_2$.
The set of such double cosets does not appear to follow easily from any general theory, but double cosets can be enumerated efficiently by an algorithm in GAP \cite{GAP4}.

Stanglegrams, i.e.\ symmetric tanglegrams as defined above, have further symmetries.
For these one can start by ordering the tree shapes and only taking tangles where $t_1$ is smaller than or equal to $t_2$ in this ordering.
In cases where $t_1 = t_2 = t$, we note that by exchanging the roles of $t_1$ and $t_2$ shows that $(t, t, \mu)$ is equivalent to $(t, t, \mu^{-1})$, meaning that we only need to take one of these for our enumeration.

For this study, I enumerated tanglegrams by taking triples $(s_i, s_j, C)$, where $C$ is a one of the double cosets $\aut(s_i) \pairing \aut(s_j)$ enumerated by GAP.
To take the extra symmetry induced by stanglegrams into account, I wrote some GAP code to look for tanglegrams that remained the same after inversion on the basis of representatives (which have an easily defined total order), which was necessary because a naive $O(n^2)$ search on double cosets (for which a total order is not available in GAP, but see \cite{Hulpke2003-em}) was too slow.
There are lots of stanglegrams (Figure~\ref{FIGcount}), but significantly fewer than the number of pairs of distinct phylogenetic trees:
\FIGcount



\section{Labeled tanglegram symmetries}
We are also interested in symmetries of labeled tanglegrams, and follow a similar path through planar tanglegrams to describe them.
Labeled planar $n$-tanglegrams with a given pair of tree shapes (i.e.\ elements of $\pi_\shape^{-1}(s_1, s_2)$ for some $s_1$ and $s_2$) are in one to one correspondence with pairs of permutations, in which we connect taxa with the same label to form a tanglegram.
\emph{Note that this focus on labels is different from that in the previous section, in which the focus was on the bijection between the leaves.}

Let us begin by assuming a planar tree shape $t_1$ on $n$ taxa.
The labelings of this planar tree shape are equivalent to permutations $\fS_n$, and the group composition law can be thought of as doing relabeling.
The automorphisms of this planar tree shape giving the same (non-planar) labeled phylogenetic tree can then be thought of as a subgroup $\aut(t_1)$ of $\fS_n$ as above which acts on the left of $\fS_n$.
In this way the (non-planar) labeled phylogenetic trees with the given shape are equivalent to the right cosets $A(t_1) \sigma$ for $\sigma \in \fS_n$.

Similarly, given two tree shapes, the planar labeled tangles with those tree shapes are given by elements of the direct product $\fS_n \times \fS_n$.
Then the (non-planar) tangles are again equivalent to the right cosets $(\aut(t_1), \aut(t_2)) (\sigma_1, \sigma_2)$ for $\sigma_1, \sigma_2 \in \fS_n$.
Indeed, each pair of labeled phylogenetic trees defines a labeled tangle just by connecting leaves with the same label.

In order to enumerate these objects it is convenient to use the notion of a \emph{wreath product} with the two-element group $\ZZ_2$.
Because we will only need this particular wreath product, I will just remind the reader of the definition in this special case.

Given a group $G$, the wreath product of $G$ with $\ZZ_2$, denoted $G \wrtwo$, can be described as the direct product $G \times G \times \ZZ_2$ with the following ``twisted'' multiplication table, where $\tau$ is the non-identity element of $\ZZ_2$:
\begin{align*}
(a, b, \id) (c, d, \id) & = (ac, bd, \id) \\
(a, b, \id) (c, d, \tau) & = (ac, bd, \tau) \\
(a, b, \tau) (c, d, \id) & = (ad, bc, \tau) \\
(a, b, \tau) (c, d, \tau) & = (ad, bc, \id).
\end{align*}

We will use this concept to enumerate labeled stanglegrams up to automorphism when the tree shapes are identical.
However, first we note that $G \wrtwo$ is equivalent to the planar tanglegrams which have means of distinguishing between the two trees, say with different colors for the edges of the two trees, but which we can flip upside down.
This flipping is formalized by the presence of $\tau$; the edge coloring allows us to see the difference between $(\sigma_1, \sigma_2, \tau)$ and $(\sigma_2, \sigma_1, \id)$.

The connection with the wreath product is as follows, using the interpretation of elements of $\fS_n$ as providing leaf relabelings.
Each triple $(\sigma_1, \sigma_2, \id)$ relabels $t_1$ and $t_2$ via $\sigma_1$ and $\sigma_2$, respectively, and $(\sigma_1, \sigma_2, \tau)$ does the same but then flips the tree, exchanging $t_1$ and $t_2$.
Flipping before relabeling with a pair of group elements effectively exchanges the order of the pair, which corresponds to the ``twisted'' product law in the wreath product.
These represent all of the symmetries of such a labeled tanglegram.

Because flipping the tree before labeling doesn't do anything (recall that tree shapes are identical), the collection of edge colored tanglegrams is equivalent to the right cosets $\langle \aut(t_1) \times \aut(t_2) \times \ZZ_2 \rangle \, (\sigma_1, \sigma_2)$ for $\sigma_1, \sigma_2 \in \fS_n$.
Now, if we forget the difference between $t_1$ and $t_2$, say by removing colors from the edges, the set of tanglegrams is equivalent to double cosets
$\langle \aut(t_1) \times \aut(t_2) \times \ZZ_2 \rangle \, (\sigma_1, \sigma_2) \, \langle {\id} \times {\id} \times \ZZ_2 \rangle$ for $\sigma_1, \sigma_2 \in \fS_n$.


\subsection{Labeled tanglegram enumeration}
In order to enumerate the labeled tanglegrams in terms of the tanglegrams as thus defined, it is easy to define a map that corresponds to de-labeling a map.
Indeed, the map
\[
(\aut(t_1), \aut(t_2)) (\sigma_1, \sigma_2) \mapsto \aut(t_1) \sigma_1 \sigma_2^{-1} \aut(t_2)
\]
from right cosets of $\fS_n \times \fS_n$ to double cosets of $\fS_n$ is well defined.
These double cosets of $\fS_n$ give exactly the mappings $\pairing$ defining the possible tangles.
Thus, the pre-image of this map for a given tangle gives the possible labelings of that tangle.

In the case of stanglegrams when the trees have identical shapes, these objects are identified as elements of the wreath product $\fS_n \wrtwo$.
There is still a well-defined map of these objects to the collection of double cosets $\aut(t) \pairing \aut(t)$ which are unique up to inversion of $\pairing$.
As in the previous case, the pre-image of this map for a given stangle gives the possible labelings of that tangle.


\section{Action of the tree normalizers on tanglegrams}
Recall that the \emph{normalizer} $N_H(G)$ of a subgroup $H$ in $G$ is the subgroup of elements $g \in G$ such that $gHg^{-1} = H$.
For any tangle $y = (t_1, t_2, \pairing)$ and $\sigma \in N_{\aut(t_2)}(\fS_n)$ there is an element $\rho_\sigma(y) \in \tangle_n$ induced by right multiplication on $\pairing$.
That is, for $\sigma \in \fS_n$ and $(t_1, t_2, \pairing) \in \tangle_n$,
\begin{equation}
\label{eq:action}
\rho_\sigma (t_1, t_2, \pairing) := (t_1, t_2, \pairing \sigma).
\end{equation}
This is well defined by the definition of the normalizer.
We can think about this as giving the leaf-to-leaf mapping obtained by reordering the \emph{image} of the pairing map, which are the leaves of $t_1$.

Identical considerations hold for the corresponding left map $\lambda_\sigma$.
We also note that
\[
\rho_{\pairing^{-1} \sigma \pairing} (t_1, t_2, \pairing) =
(t_1, t_2, \sigma \pairing) =
\lambda_{\sigma} (t_1, t_2, \pairing)
\]
but that this is only well defined for $\sigma \in N_{\aut(t_2)}(\fS_n)$ as before.

These do not give group actions of $\fS_n$ on the complete set of $n$-tangles $\tangle_n$.
For example, let $t_1$ be the tree $((((1,2),3),4),5)$ and let $t_2$ be the tree $(1,(2,(3,(4,5))))$.
Abbreviating $\aut(t_i)$ with $A_i$, note that because $(4 5) \in A_2$, $A_1 e A_2$ and $A_1 (4 5) A_2$ are in the same coset yet they have different results upon application of $(3 4)$:
\begin{align*}
A_1 (3 4) A_2 & = \langle (1 2) \rangle \{(3 4), (3 5 4)\} \\
A_1 (4 5) (3 4) A_2 & = \langle (1 2) \rangle \{(3 4), (3 4 5)\}.
\end{align*}
This sort of behavior is to be expected whenever a $g$ (here played by $(3 4)$) is not in the normalizer of $A_2$ in $\fS_n$, such that there is an $\alpha$ (here played by $(4 5)$) such that $g \alpha g^{-1}$ is not in $A_2$, and the effect of this conjugation is not absorbed by $A_1$.

However, there is a well defined group action on a subset of the domain as follows.
Let $R(t)$ (resp.\ $L(t)$) be the set of tangles $(t_1, t_2, C)$ such that $t_2$ (resp.\ $t_1$) is graph-theoretically isomorphic to $t$.
Now $N_{\aut(t)}(\fS_n)$ gives a well defined action on the right (resp.\ left) of $R(t)$ (resp.\ $L(t)$) by definition.
Indeed, we know that any such action on a $R(t)$ is going to result in another element of $R(t)$ by definition, and the action is well defined by the definition of the normalizer.
The normalizer criterion is in fact quite sensible from the perspective of phylogenetics, in that it ensures that pairs of leaves that are ``equivalent'' (formalized as being in the same cycle under the tree automorphism group) get the same treatment under the group action \eqref{eq:action} or its left map equivalent.


\section{Discussion and future work}
These considerations also lead to a graph-theoretic interpretation for problems defined as minimizing paths on graphs with trees as vertices, such as SPR.
For example, rather than considering SPR as shortest path calculation on a graph with trees as vertices and edges being SPR moves, one can think of it as happening on a graph formed by pairs of trees with edges connecting pairs of tree pairs that are identical after one SPR move on one of the trees.
The SPR distance distance then is the distance from a given vertex to a vertex composed of identical trees.
This graph has symmetries from relabeling all tree leaves.
The resulting quotient graph is a graph with vertices $\tangle_n$ obtained by applying $\pi_\tangle$.

Effect of tree rearrangements such as SPR.

Amortized algorithms.

Here we note that unrooted tanglegrams have further symmetries that do not follow directly from the considerations described here.
Given a rooted tanglegram, it is easy to define an unrooted tanglegram by placing a leaf on each root node and mapping one of these leaves to the other.
However, this is a many-to-one map because different rootings of the trees in the unrooted tanglegram may have different rooted tree topologies and thus will be distinct rooted tanglegrams.
Even when two rootings have the same topology, the corresponding rooted tanglegrams may be different:
the tanglegram
$$((1,(2,(3,(4,(5,6))))), (1,(2,(3,(4,(5,6))))), (2\ 4\ 3))$$
when rerooted at the edge leading to taxon 1 becomes
$$((((((1,2),3),4),5),6), (((((1,2),3),4),5),6), (2\ 4\ 3));$$
upon renumbering this becomes
$$((1,(2,(3,(4,(5,6))))), (1,(2,(3,(4,(5,6))))), (2\ 3\ 4))$$
which is not isomorphic to the original.
Thus, unrooted tanglegrams can be thought of as equivalence classes of rooted tanglegrams, but this equivalence does not appear trivial.


\section{Acknowledgements}
This manuscript was substantially shaped by discussions with Michael Landis, Arnold Kas, Chris Whidden, and Bianca Viray.

\bibliographystyle{unsrt}
\bibliography{tangle}


\notarxiv{
\section{Figure legends}
\FIGspr
\FIGtanglegram
\FIGcount
}
\end{document}



